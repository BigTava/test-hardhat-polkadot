import { createClient } from "polkadot-api";
import { getWsProvider } from "polkadot-api/ws-provider/web";
import { Binary, AccountId } from "polkadot-api";
import { passetHub } from "@polkadot-api/descriptors";

// npx hardhat run ./scripts/test-papi.ts --network localNode
async function main() {
  const dotProvider = getWsProvider("ws://127.0.0.1:8000", (status) =>
    console.log("status", status)
  );
  const client = createClient(dotProvider);

  const unsafeApi = client.getUnsafeApi();
  const safeApi = client.getTypedApi(passetHub);

  const safeToken = await safeApi.compatibilityToken;
  const unsafeToken = await unsafeApi.runtimeToken;

  const prefix = unsafeApi.constants.System.SS58Prefix(unsafeToken);
  const sampleHash = "0x" + "a".repeat(64);

  // Create the key correctly:
  const key = Binary.fromHex(sampleHash);
  const code = await unsafeApi.query.Revive.PristineCode.getValue(key);
  const opt = await unsafeApi.query.Revive.PristineCode.getValue(key);

  let uploadCode = await safeApi.apis.ReviveApi.upload_code(
    "5GrwvaEF5zXb26Fz9rcQpDWS57CtERHpNehXCPcNoHGKutQY",
    Binary.fromHex(
      "0x50564d0000cf07000000000000010700c13000c0008004808f08000000000e0000001c0000002a0000003500000040000000520000005d00000063616c6c5f646174615f636f707963616c6c5f646174615f6c6f616463616c6c5f646174615f73697a656765745f73746f726167657365616c5f72657475726e7365745f696d6d757461626c655f646174617365745f73746f7261676576616c75655f7472616e7366657272656405110285cd0463616c6c85d4066465706c6f79068710130286212b0073019a02a302a80204030f032803c803d20317042a0448044d0466048105a305d405dc05390808000251081c04330730000383770a05280f049511f07b10087b156489647533082064975010021b027c78017c797c7a027c7b03978808d4980897aa1097bb18d4ba0ad4a8087c79057c7a047c7b067c7c07979908d4a90997bb1097cc18d4cb0bd4b909979920d489027c79097c7a087c7b0a7c7c0b979908d4a90997bb1097cc18d4cb0bd4b9097c7a0d7c7b0c7c7c0e7c780f97aa08d4ba0a97cc10978818d4c808d4a808978820d498037c78117c7a107c7b127c7c13978808d4a80897bb1097cc18d4cb0bd4b8087c7a157c7b147c7c167c791797aa08d4ba0a97cc10979918d4c909d4a909979920d4890a7c78197c79187c7b1a7c7c1b978808d4980897bb1097cc18d4cb0bd4b8087c791d7c7b1c7c7c1e7c771f979908d4b90997cc10977718d4c707d49707977720d487076f776fa86f396f2a7b5a187b59107b58087b57821008821595111032009511d87b10207b15187b161082897b19088289087b19828510828618330820501004d3006f686f59821a6faa821b086fbb787b18787a10787908787898bc38787c1f98bc30787c1e98bc28787c1d98bc20787c1c98bc18787c1b98bc10787c1a98bb08787b1998ab38787b1798ab30787b1698ab28787b1598ab20787b1498ab18787b1398ab10787b1298aa08787a11989a38787a0f989a30787a0e989a28787a0d989a20787a0c989a18787a0b989a10787a0a98990878790998893878790798893078790698892878790598892078790498891878790398891078790298880878780182102082151882161095112832008b7910520931c8780883881f8488e05638000001253309040002390a040002ae8a093d080400020133081000028377c887073200009511f07b10087b158475010a020133080000023d0700000251050c33000633020a28710333000833021c28680350120a65034911784911704911684911608317600a0701821770821878821968821a60d49808d4a707d4870752072701390600000297672098772095771f8477e095788000d878077b18407b174894777b1750330740c8710849115850100c50fe33078000646850100e37ff8377646833090a0154161feb0095172033088000501010f2fc821720821828821930821a38492198004921900049218800492180007b1ab8007b19b0007b18a8007b17a000951780009518a0003300129511a07b10587b15509515608411e08272827a08827b108277188283828908828c108288186f746fbb6faa6f276f826fcc6f996f387b17187b1a107b1b087b147b18387b19307b1c287b12208318831a203309ff330b2033070a069551a08210588215509511603200641733084050101448fc8217188218108219088216d49707d48609d47909989920d48707977720d4970751071c0033081000028388330701283b33081000028388330701282f646733085010162ffe8377330833090a28e2fb646733085010181cfe83783307330933001a0a0433021c28d001330933001a0a0433021c28c30150121cc0014911584911504911408000330740c8710849114850101eeefc330600000239070000025317045983176033080a010180177c9777201408000000003aa1d473ab873d49219800492190004921880049218000831780000a0701821790008218980082198800821a8000d49808d4a707d4870751071a33081000022808330810000201838833070133090a040181675617030b330810000228eb4921b8004921b0004921a8004921a0009517209518a0003300209511a07b10587b15507b16489515608411e06476828718828910828a0882886f776f996faa6f887b18187b1a107b19087b17491138491130491128491120481140208318831a20831b403309ff33070a03821738821830821928821a206f776f886f996faa7b6a187b69107b68087b679551a08210588215508216489511603200821920821728821830821a387b1a187b18107b17083307800064187b19501022b1fb390804000256289f000d2003040002a0000133071000028378800033092033070a04330733002428acfc3307501024a7fc3307015010269ffc82ab7b1b1882ab087b1b2082ab107b1b2882aa187b1a308296829a087b1a829a107b1a088299187b19103202951120ff7b10d8007b15d0007b16c8009515e0008411e03202214225a952484992244992244992244992244992244992244992244992244992244992244992542529a524292949a84a494a9224499224499224499224499224499224499224499292244108094369521a429224094992264992084912494a921085ea9008491211111111912449494a525595a42429492549252429499264288552856a2a542929252109494208919a049088886844449284c2528b50444422499294a4aa24254994a492a42a4949929224495408213044aaa4905092242925491111910000"
    ),
    undefined // storage deposit limit
  );

  let safeCall = safeApi.tx.Revive.upload_code({
    code: Binary.fromHex(
      "0x50564d0000cf07000000000000010700c13000c0008004808f08000000000e0000001c0000002a0000003500000040000000520000005d00000063616c6c5f646174615f636f707963616c6c5f646174615f6c6f616463616c6c5f646174615f73697a656765745f73746f726167657365616c5f72657475726e7365745f696d6d757461626c655f646174617365745f73746f7261676576616c75655f7472616e7366657272656405110285cd0463616c6c85d4066465706c6f79068710130286212b0073019a02a302a80204030f032803c803d20317042a0448044d0466048105a305d405dc05390808000251081c04330730000383770a05280f049511f07b10087b156489647533082064975010021b027c78017c797c7a027c7b03978808d4980897aa1097bb18d4ba0ad4a8087c79057c7a047c7b067c7c07979908d4a90997bb1097cc18d4cb0bd4b909979920d489027c79097c7a087c7b0a7c7c0b979908d4a90997bb1097cc18d4cb0bd4b9097c7a0d7c7b0c7c7c0e7c780f97aa08d4ba0a97cc10978818d4c808d4a808978820d498037c78117c7a107c7b127c7c13978808d4a80897bb1097cc18d4cb0bd4b8087c7a157c7b147c7c167c791797aa08d4ba0a97cc10979918d4c909d4a909979920d4890a7c78197c79187c7b1a7c7c1b978808d4980897bb1097cc18d4cb0bd4b8087c791d7c7b1c7c7c1e7c771f979908d4b90997cc10977718d4c707d49707977720d487076f776fa86f396f2a7b5a187b59107b58087b57821008821595111032009511d87b10207b15187b161082897b19088289087b19828510828618330820501004d3006f686f59821a6faa821b086fbb787b18787a10787908787898bc38787c1f98bc30787c1e98bc28787c1d98bc20787c1c98bc18787c1b98bc10787c1a98bb08787b1998ab38787b1798ab30787b1698ab28787b1598ab20787b1498ab18787b1398ab10787b1298aa08787a11989a38787a0f989a30787a0e989a28787a0d989a20787a0c989a18787a0b989a10787a0a98990878790998893878790798893078790698892878790598892078790498891878790398891078790298880878780182102082151882161095112832008b7910520931c8780883881f8488e05638000001253309040002390a040002ae8a093d080400020133081000028377c887073200009511f07b10087b158475010a020133080000023d0700000251050c33000633020a28710333000833021c28680350120a65034911784911704911684911608317600a0701821770821878821968821a60d49808d4a707d4870752072701390600000297672098772095771f8477e095788000d878077b18407b174894777b1750330740c8710849115850100c50fe33078000646850100e37ff8377646833090a0154161feb0095172033088000501010f2fc821720821828821930821a38492198004921900049218800492180007b1ab8007b19b0007b18a8007b17a000951780009518a0003300129511a07b10587b15509515608411e08272827a08827b108277188283828908828c108288186f746fbb6faa6f276f826fcc6f996f387b17187b1a107b1b087b147b18387b19307b1c287b12208318831a203309ff330b2033070a069551a08210588215509511603200641733084050101448fc8217188218108219088216d49707d48609d47909989920d48707977720d4970751071c0033081000028388330701283b33081000028388330701282f646733085010162ffe8377330833090a28e2fb646733085010181cfe83783307330933001a0a0433021c28d001330933001a0a0433021c28c30150121cc0014911584911504911408000330740c8710849114850101eeefc330600000239070000025317045983176033080a010180177c9777201408000000003aa1d473ab873d49219800492190004921880049218000831780000a0701821790008218980082198800821a8000d49808d4a707d4870751071a33081000022808330810000201838833070133090a040181675617030b330810000228eb4921b8004921b0004921a8004921a0009517209518a0003300209511a07b10587b15507b16489515608411e06476828718828910828a0882886f776f996faa6f887b18187b1a107b19087b17491138491130491128491120481140208318831a20831b403309ff33070a03821738821830821928821a206f776f886f996faa7b6a187b69107b68087b679551a08210588215508216489511603200821920821728821830821a387b1a187b18107b17083307800064187b19501022b1fb390804000256289f000d2003040002a0000133071000028378800033092033070a04330733002428acfc3307501024a7fc3307015010269ffc82ab7b1b1882ab087b1b2082ab107b1b2882aa187b1a308296829a087b1a829a107b1a088299187b19103202951120ff7b10d8007b15d0007b16c8009515e0008411e03202214225a952484992244992244992244992244992244992244992244992244992244992244992542529a524292949a84a494a9224499224499224499224499224499224499224499292244108094369521a429224094992264992084912494a921085ea9008491211111111912449494a525595a42429492549252429499264288552856a2a542929252109494208919a049088886844449284c2528b50444422499294a4aa24254994a492a42a4949929224495408213044aaa4905092242925491111910000"
    ),
    storage_deposit_limit: 10_000_000_000n,
  });
  let unsafeCall = unsafeApi.tx.Revive.upload_code({
    code: Binary.fromHex(
      "0x50564d0000cf07000000000000010700c13000c0008004808f08000000000e0000001c0000002a0000003500000040000000520000005d00000063616c6c5f646174615f636f707963616c6c5f646174615f6c6f616463616c6c5f646174615f73697a656765745f73746f726167657365616c5f72657475726e7365745f696d6d757461626c655f646174617365745f73746f7261676576616c75655f7472616e7366657272656405110285cd0463616c6c85d4066465706c6f79068710130286212b0073019a02a302a80204030f032803c803d20317042a0448044d0466048105a305d405dc05390808000251081c04330730000383770a05280f049511f07b10087b156489647533082064975010021b027c78017c797c7a027c7b03978808d4980897aa1097bb18d4ba0ad4a8087c79057c7a047c7b067c7c07979908d4a90997bb1097cc18d4cb0bd4b909979920d489027c79097c7a087c7b0a7c7c0b979908d4a90997bb1097cc18d4cb0bd4b9097c7a0d7c7b0c7c7c0e7c780f97aa08d4ba0a97cc10978818d4c808d4a808978820d498037c78117c7a107c7b127c7c13978808d4a80897bb1097cc18d4cb0bd4b8087c7a157c7b147c7c167c791797aa08d4ba0a97cc10979918d4c909d4a909979920d4890a7c78197c79187c7b1a7c7c1b978808d4980897bb1097cc18d4cb0bd4b8087c791d7c7b1c7c7c1e7c771f979908d4b90997cc10977718d4c707d49707977720d487076f776fa86f396f2a7b5a187b59107b58087b57821008821595111032009511d87b10207b15187b161082897b19088289087b19828510828618330820501004d3006f686f59821a6faa821b086fbb787b18787a10787908787898bc38787c1f98bc30787c1e98bc28787c1d98bc20787c1c98bc18787c1b98bc10787c1a98bb08787b1998ab38787b1798ab30787b1698ab28787b1598ab20787b1498ab18787b1398ab10787b1298aa08787a11989a38787a0f989a30787a0e989a28787a0d989a20787a0c989a18787a0b989a10787a0a98990878790998893878790798893078790698892878790598892078790498891878790398891078790298880878780182102082151882161095112832008b7910520931c8780883881f8488e05638000001253309040002390a040002ae8a093d080400020133081000028377c887073200009511f07b10087b158475010a020133080000023d0700000251050c33000633020a28710333000833021c28680350120a65034911784911704911684911608317600a0701821770821878821968821a60d49808d4a707d4870752072701390600000297672098772095771f8477e095788000d878077b18407b174894777b1750330740c8710849115850100c50fe33078000646850100e37ff8377646833090a0154161feb0095172033088000501010f2fc821720821828821930821a38492198004921900049218800492180007b1ab8007b19b0007b18a8007b17a000951780009518a0003300129511a07b10587b15509515608411e08272827a08827b108277188283828908828c108288186f746fbb6faa6f276f826fcc6f996f387b17187b1a107b1b087b147b18387b19307b1c287b12208318831a203309ff330b2033070a069551a08210588215509511603200641733084050101448fc8217188218108219088216d49707d48609d47909989920d48707977720d4970751071c0033081000028388330701283b33081000028388330701282f646733085010162ffe8377330833090a28e2fb646733085010181cfe83783307330933001a0a0433021c28d001330933001a0a0433021c28c30150121cc0014911584911504911408000330740c8710849114850101eeefc330600000239070000025317045983176033080a010180177c9777201408000000003aa1d473ab873d49219800492190004921880049218000831780000a0701821790008218980082198800821a8000d49808d4a707d4870751071a33081000022808330810000201838833070133090a040181675617030b330810000228eb4921b8004921b0004921a8004921a0009517209518a0003300209511a07b10587b15507b16489515608411e06476828718828910828a0882886f776f996faa6f887b18187b1a107b19087b17491138491130491128491120481140208318831a20831b403309ff33070a03821738821830821928821a206f776f886f996faa7b6a187b69107b68087b679551a08210588215508216489511603200821920821728821830821a387b1a187b18107b17083307800064187b19501022b1fb390804000256289f000d2003040002a0000133071000028378800033092033070a04330733002428acfc3307501024a7fc3307015010269ffc82ab7b1b1882ab087b1b2082ab107b1b2882aa187b1a308296829a087b1a829a107b1a088299187b19103202951120ff7b10d8007b15d0007b16c8009515e0008411e03202214225a952484992244992244992244992244992244992244992244992244992244992244992542529a524292949a84a494a9224499224499224499224499224499224499224499292244108094369521a429224094992264992084912494a921085ea9008491211111111912449494a525595a42429492549252429499264288552856a2a542929252109494208919a049088886844449284c2528b50444422499294a4aa24254994a492a42a4949929224495408213044aaa4905092242925491111910000"
    ),
    storage_deposit_limit: 10_000_000_000n,
  });

  const payload = unsafeCall.getEncodedData(unsafeToken);
}

main()
  .then(() => process.exit(0))
  .catch((error) => {
    console.error(error);
    process.exit(1);
  });
